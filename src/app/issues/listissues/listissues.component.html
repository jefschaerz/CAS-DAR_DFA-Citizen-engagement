<div class="container-fluid my-container">
    <div class="row">
        <div class="col-lg-4">
            <h4>See issues</h4>
        </div>
        <div class="col-lg-8">
            <app-alert>Alert :</app-alert>
        </div>
    </div>
    <hr>
    <div class="row my-row">
        <!-- Main row -->
        <div class="container-fluid col-lg-4 mb-4 my-container"
             col-4>
            <!-- Container for the Map-->
            <app-map [addNewMarkerOnMapAllowed]=addNewMarkerAllowed>Map</app-map>
        </div>
        <div class="container-fluid col-lg-8 my-container">
            <div class="row my-row mt-2">
                <div class="col-lg-6">
                    <h5 class="">Filter by state</h5>
                    <div class="form-group mb-2">
                        <label class="mr-4"
                               *ngFor="let state of checkboxesDataList; let i = index">
                            <input id="state{{i}}"
                                   name="states"
                                   type="radio"
                                   [(value)]="state.href"
                                   [(ngModel)]="selectedState.href"
                                   (ngModelChange)="refreshFilterAndSearch()">
                            {{state.label}}</label>
                    </div>
                </div>
                <div class="form-group mb-2 ml-3">
                    <h5 class="">Filter by owner</h5>
                    <label class="mr-4"><input name="FilterAuthorHref"
                               type="radio"
                               value="No"
                               [(ngModel)]="selectOnlyOwnIssue"
                               (ngModelChange)="refreshFilterAndSearch()" />
                        Show all issues</label>
                    <label class="mr-4"><input name="FilterAuthorHref"
                               type="radio"
                               value="Yes"
                               [(ngModel)]="selectOnlyOwnIssue"
                               (ngModelChange)="refreshFilterAndSearch()" />
                        Show only my issues</label>

                </div>
            </div>
            <div class="row my-row mt-2">
                <div class="col-lg-6 my-col">
                    <h5 class="">Search in description</h5>
                    <div class="form-group form-inline mb-4">
                        <input class="form-control"
                               type="text"
                               [(ngModel)]="searchText"
                               (ngModelChange)="refreshFilterAndSearch()"
                               placeholder="keyword">
                        <button class="btn btn-primary"
                                (click)="clearSearchField()"><i class="fa fa-times-circle"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="row my-row">
                <div class="col-lg-6 my-col">
                    <pagination id="paginationIssue"
                                [totalItems]="displayedIssues.length"
                                [(ngModel)]="issueCurrentPage"
                                [itemsPerPage]="issuePerPage"
                                (pageChanged)="pageChanged($event)"></pagination>
                </div>
                <div class="col-lg-6 my-col">
                    <h5>
                        <p *ngIf="(displayedIssues.length >0); else noResults"> Currently displayed:
                            {{displayedIssues.length}} / Total of issues:
                            {{allIssues.length}}</p>
                        <ng-template #noResults>
                            <p>No issues found with your current filter "{{searchText}}".</p>
                        </ng-template>
                    </h5>
                </div>

            </div>
            <div class="content-wrapper mt-2">
                <!-- One Card -->
                <div class="row my-row">
                    <div class="col-lg-6"
                         *ngFor="let issue of currentPageIssues ; let index = index;"
                         scope="row">
                        <div class="card border-secondary mb-3">
                            <!-- Card Header -->
                            <div class="card-header border-1">
                                <div class="row my-row">
                                    <div class="col my-col">
                                        <span class="badge badge-pill badge-success float-right">{{issue.state}}
                                        </span>
                                        <span class="badge badge-secondary float-left mr-2">
                                            {{this.issueTypeService.getIssueDescriptionFromTypeHref(issueTypes, issue.issueTypeHref)}}
                                        </span>

                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="card-text">
                                    <div class="container-fuid">
                                        <div class="row my-row">
                                            <div class="col-3"><img src="{{issue.imageUrl}}"
                                                     alt=""
                                                     width="70">
                                            </div>
                                            <div class="col">
                                                <h6><strong>{{issue.description}}</strong></h6>
                                                <p>Href : {{issue.creatorHref}} </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <hr>
                                <div class="row">
                                    <div class="col-sm-7 col-lg-7">
                                        <p>Tags:
                                            <br>
                                            <span *ngFor="let tag of issue.tags; let i = index;"
                                                  class="badge badge-warning ml-1">{{tag}}</span>
                                        </p>
                                    </div>
                                    <div class="col-sm-5 col-lg-5">
                                        <button type="button"
                                                class="btn btn-primary mr-1"
                                                (click)="onEditComments(issue.id)">Comments
                                        </button>
                                        <button *ngIf="isThisIssueOwnIssue(issue.creatorHref)"
                                                type="
                                                button"
                                                class="btn btn-primary"
                                                (click)="onEditIssue(issue.id)">Edit
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<button (click)="getIssuesList()">Refresh list</button>

<div>
    <h2>All Issues (not filtered)</h2>
    <table class="table table-hover table-bordered"
           *ngIf="(allIssues.length >0); else noResults">
        <thead>
            <tr>
                <th scope="col">Actions</th>
                <th scope="col">Comments</th>
                <th scope="col">#</th>
                <!-- <th scope="col">AssignedHref</th> -->
                <th scope="col">CreatedAt</th>
                <th scope="col">CreatorHref</th>
                <th scope="col">Description</th>
                <!-- <th scope="col">Href</th> -->
                <th scope="col">Id</th>
                <th scope="col">ImageURL</th>
                <th scope="col">additionnalImageURLs</th>
                <!-- <th scope="col">IssuetypeHref</th> -->
                <th scope="col">Location</th>
                <!-- <th scope="col">State</th> -->
                <th scope="col">Tags</th>
                <!-- <th scope="col">UpdatedAt</th> -->

            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let issue of allIssues ; let index = index; "
                scope="row">
                <td>
                    <button (click)="onEditIssue(issue.id)">Edit</button>
                    <button (click)="onEditComments(issue.id)">Edit comments</button>
                </td>
                <td (click)="onSelect(issue)">{{index+1}}</td>
                <!-- <td (click)="onSelect(issue)">{{issue.assigneeHref}}</td> -->
                <td (click)="onSelect(issue)">{{issue.createdAt}}</td>
                <td (click)="onSelect(issue)">{{issue.creatorHref}}</td>
                <td (click)="onSelect(issue)">{{issue.description}}</td>
                <!-- <td (click)="onSelect(issue)">{{issue.href}}</td> -->
                <td (click)="onSelect(issue)">{{issue.id}}</td>
                <td (click)="onSelect(issue)">{{issue.imageUrl}}</td>
                <td (click)="onSelect(issue)">{{issue.additionalImageUrls}}</td>
                <!-- <td (click)="onSelect(issue)">{{issue.issueTypeHref}}</td> -->
                <td (click)="onSelect(issue)">{{issue.location.coordinates[0]}}
                    {{issue.location.coordinates[1]}}</td>
                <!-- <td (click)="onSelect(issue)">{{issue.state}}</td> -->
                <td (click)="onSelect(issue)">{{issue.tags}}</td>
                <!-- <td (click)="onSelect(issue)">{{issue.updatedAt}}</td> -->
            </tr>
        </tbody>
    </table>
</div>