<div class="row my-row">
    <!-- Main row -->
    <div class="container-fluid col-md-5 my-container">
        <!-- Container for the Map-->
        <app-map [addNewMarkerOnMapAllowed]=addNewMarkerAllowed>Map</app-map>
    </div>
    <div class="container-fluid col-md-7 my-container">
        <!-- Container for the data collect or display -->
        <div>
            <h4 *ngIf=(isNewIssue)>Add an issue</h4>
            <h4 *ngIf=(!isNewIssue)>Edit issue with ID : {{ issueId }}</h4>
        </div>
        <hr>
        <div class="row my-row"
             *ngIf=(!isNewIssue)>
            <div class="col">
                <div class="form-group my-form-group">
                    <label class="col-3 justify-content-start">Current state</label>
                    <!-- TODO create component to handle this (display correct colored button according to state ?!-->

                    <button [ngClass]="{'btn-secondary': issue.state === 'new'}"
                            class="btn mr-2">New</button>

                    <button [ngClass]="{'btn-info': issue.state === 'inProgress'}"
                            class="btn  mr-2">In progress</button>

                    <button [ngClass]="{'btn-danger': issue.state === 'rejected'}"
                            class="btn mr-2">Rejected</button>

                    <button [ngClass]="{'btn-success': issue.state === 'resolved'}"
                            class="btn mr-2">Resolved</button>
                </div>
            </div>

        </div>

        <!-- Template-driven method-->
        <form #IssueForm="ngForm"
              (submit)="onSubmit(IssueForm)">
            <!-- Styles OK -->
            <div class="row my-ow">
                <div class="col">
                    <div class="form-group form-inline my-form-group">
                        <label class="col-3 justify-content-start"
                               for="issueTypes">Type of issues</label>
                        <select class="custom-select"
                                #mySelect
                                [(ngModel)]="issue.issueTypeHref"
                                (change)='onIssueTypeSelected(mySelect.value)'
                                name="selectIssueType">
                            <option disabled
                                    selected> - Select one - </option>
                            <!-- Save href value in issueTypeHref but display issueType.description -->
                            <option [(ngValue)]="issueType.href"
                                    *ngFor="let issueType of issueTypes">
                                {{issueType.description}}
                            </option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="row my-row">
                <div class="col">
                    <div class="form-group form-inline my-form-group">
                        <label class="col-3 justify-content-start"
                               for="description">Description</label>
                        <input class="form-control col"
                               type="text"
                               name="description"
                               id="description"
                               #descriptionField="ngModel"
                               required
                               [(ngModel)]="issue.description"
                               maxlength="1000"
                               ng-pattern
                               placeholder="Provide a description" />
                        <p *ngIf="descriptionField.hasError('required') && descriptionField.touched">
                            Description is required
                        </p>
                    </div>
                </div>
            </div>

            <div class="row my-row">
                <div class="col">
                    <div class="form-group form-inline my-form-group">
                        <label class="col-3 justify-content-start"
                               for="location">Location</label>
                        <div class="form-group form-inline">
                            <label for="latitude"
                                   class="justify-content-start ml-2 mr-2">Latitude</label>
                            <input class="form-control"
                                   type="text"
                                   name="location_lat"
                                   id="location_lat"
                                   #latitudeField="ngModel"
                                   required
                                   [(ngModel)]="issue.location.coordinates[0]"
                                   ng-pattern />
                        </div>
                        <div class="form-group form-inline">
                            <label for="longitude"
                                   class="ml-2 mr-2">Longitude</label>
                            <input class="form-control"
                                   type="text"
                                   name="location_long"
                                   id="location_long"
                                   #longitudeField="ngModel"
                                   required
                                   [(ngModel)]="issue.location.coordinates[1]"
                                   ng-pattern />
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-group form-inline my-form-group">
                <label class="col-3 justify-content-start"
                       for="tag">Tags</label>
                <input class="form-control"
                       type="text"
                       name="tag"
                       id="tag"
                       #descriptionField="ngModel"
                       [(ngModel)]="newTag"
                       maxlength="20"
                       ng-pattern />
                <button class="form-control btn btn-primary ml-2"
                        type="button"
                        (click)="addTagToIssue()">Add this tag</button>
            </div>
            <div class="row my-row ml-10 mb-2">
                <div class="col-3">
                    <label *ngIf="(issue.tags.length > 0)"
                           class="ml-3"
                           for="currenttag">Current tags</label>
                </div>
                <div *ngFor="let tag of issue.tags; let i = index;"
                     class="card text-center"
                     style="width: 7rem;">
                    <div class="card-body">
                        <h4><span class="badge badge-info ml-1 ">{{tag}}</span></h4>
                        <button class="btn btn-xs btn-warning"
                                (click)="removeTag(i)">
                            Delete
                        </button>
                    </div>
                </div>
            </div>

            <div class="form-group form-inline my-form-group">
                <label class="col-3 justify-content-start"
                       for="tag">Picture URL</label>
                <input class="form-control col-5"
                       type="text"
                       name="picture"
                       id="picture"
                       #descriptionField="ngModel"
                       [(ngModel)]="this.issue.imageUrl"
                       maxlength="500"
                       ng-pattern />
                <img *ngIf="(issue.imageUrl.length > 0)"
                     src="{{this.issue.imageUrl}}"
                     alt="this.issue.imageUrl"
                     width="30" />

                <button class="form-control ml-2 mr-2 col-md-2 btn btn-primary float-right"
                        type="button"
                        (click)="addFakeImageURL()">Browse (NA)</button>

            </div>

            <div class="form-group form-inline my-form-group">
                <label class="col-3 justify-content-start"
                       for="additionalpictures">Additionnal pictures URL</label>
                <input class="form-control col-5"
                       type="text"
                       name="additionalpictures"
                       id="additionalpictures"
                       #descriptionField="ngModel"
                       [(ngModel)]="newAdditionalPictureURL"
                       maxlength="500"
                       ng-pattern />
                <img *ngIf="(newAdditionalPictureURL.length > 0)"
                     src="{{newAdditionalPictureURL}}"
                     alt="this.issue.imageUrl"
                     width="30" />
                <span>
                    <button class="form-control ml-2 mr-2 col-md-6 btn btn-primary pull-right"
                            type="button"
                            (click)="addFakeaAdditionalImageURL()">Browse (NA)</button>
                    <button class="form-control ml-2 mr-2 col-md-6 btn btn-primary pull-right"
                            type="button"
                            (click)="addAdditionalPictureToIssue()">Add this</button>
                </span>
            </div>


            <div class="row my-row ml-10 mb-2">
                <div class="col-3">
                    <label *ngIf="(issue.additionalImageUrls.length > 0)"
                           class="ml-3"
                           for="
                        currenttag">Current pictures</label>
                </div>
                <div *ngFor="let picture of issue.additionalImageUrls; let pic = index;"
                     class="card"
                     style="width: 7rem;">
                    <img class="
                             card-img-top"
                         src="{{picture}}"
                         alt="Card image cap">
                    <div class="card-body">
                        <button class="btn btn-xs btn-warning"
                                (click)="removePicture(pic)">Delete
                        </button>
                    </div>
                </div>

            </div>
            <!-- Bottom with buttons -->
            <div class="form-group">
                <div class="row my-row">
                    <button class="form-control btn btn-success col-3"
                            type="submit"
                            [disabled]="IssueForm.invalid">
                        <ng-container *ngIf="isNewIssue">Create</ng-container>
                        <ng-container *ngIf="!isNewIssue">Update</ng-container>
                    </button>

                    <p *ngIf="issueError">
                        Unable to create the new issue. See the log for more information.
                    </p>
                    <button *ngIf=(!isNewIssue)
                            class="form-control btn btn-danger col-3 offset-1"
                            type="button"
                            (click)="deleteIssue()">Delete</button>

                    <button class="form-control btn btn-warning col-3 offset-1"
                            type="button"
                            (click)="goToAllIssues()">Cancel</button>
                </div>
            </div>
        </form>
        <p> Current issue: {{issue | json}}</p>
    </div>
</div>