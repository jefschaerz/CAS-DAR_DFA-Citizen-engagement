<div class="row rowDiv">
    <!-- Main row -->
    <div class="container-fluid col-6 boxDiv">
        <!-- Container for the Map-->
        <app-map [addNewMarkerAllowed]=addNewMarkerAllowed>Map</app-map>
    </div>
    <div class="container-fluid col-6 boxDiv">
        <!-- Container for the data collect or display -->
        <div>
            <h4 *ngIf=(isNewIssue)>Add an issue</h4>
            <h4 *ngIf=(!isNewIssue)>Edit issue with ID : {{ issueId }}</h4>
        </div>
        <div *ngIf=(!isNewIssue)
             class="form-group form-inline row">
            <div class="col-lg-3">
                <label class="justify-content-start">Current state</label>
            </div>
            <!-- TODO create component to handle this ?!-->
            <div class="col-lg-2 justify-content-md-center">
                <button [ngClass]="{'btn-secondary': issue.state === 'new'}"
                        class="btn">New</button>
            </div>
            <div class="col-lg-3 justify-content-md-center">
                <button [ngClass]="{'btn-info': issue.state === 'inProgress'}">In progress</button>
            </div>
            <div class="col-lg-2 justify-content-md-center">
                <button [ngClass]="{'btn-danger': issue.state === 'rejected'}">Rejected</button>
            </div>
            <div class="col-lg-2 justify-content-md-center">
                <button [ngClass]="{'btn-success': issue.state === 'resolved'}"
                        class="btn">Resolved</button>
            </div>

            <p></p>
        </div>
        <!-- Template-driven method-->
        <form #IssueForm="ngForm"
              (submit)="onSubmit(IssueForm)">
            <div class="form-group form-inline row">
                <div class="col-lg-3">
                    <label class="justify-content-start"
                           for="issueTypes">Type of issues</label>
                </div>
                <div><select class="col-lg custom-select"
                            #mySelect
                            [(ngModel)]="issue.issueTypeHref"
                            (change)='onIssueTypeSelected(mySelect.value)'
                            name="selectIssueType">
                        <option disabled
                                selected> - Select one - </option>
                        <!-- Save href value in issueTypeHref but display issueType.description -->
                        <option [(ngValue)]="issueType.href"
                                *ngFor="let issueType of issueTypes">
                            {{issueType.description}}
                        </option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label for="description">Description</label>
                <input class="form-control"
                       type="text"
                       name="description"
                       id="description"
                       #descriptionField="ngModel"
                       required
                       [(ngModel)]="issue.description"
                       maxlength="1000"
                       ng-pattern
                       placeholder="Provide a description" />
                <p *ngIf="descriptionField.hasError('required') && descriptionField.touched">
                    Description is required
                </p>
            </div>
            <label for="location">Location</label>
            <div class="form-group offset-1 row">
                <div class="form-inline">
                    <label for="latitude"
                           class="col-form-label">Latitude</label>
                    <input class="form-control"
                           type="text"
                           name="location_lat"
                           id="location_lat"
                           #latitudeField="ngModel"
                           required
                           [(ngModel)]="currentLocationLat"
                           ng-pattern />
                    <label for="longitude"
                           class="col-form-label">Longitude</label>
                    <input class="form-control"
                           type="text"
                           name="location_long"
                           id="location_long"
                           #longitudeField="ngModel"
                           required
                           [(ngModel)]="currentLocationLong"
                           ng-pattern />
                </div>
            </div>
            <label for="tag">Tags</label>
            <div class="form-group form-inline">
                <input class="form-control col-8"
                       type="text"
                       name="tag"
                       id="tag"
                       #descriptionField="ngModel"
                       [(ngModel)]="newTag"
                       maxlength="20"
                       ng-pattern />
                <button class="form-control col-2 btn btn-primary"
                        type="button"
                        (click)="addTagToIssue()">Add this tag</button>
            </div>

            <div class="form-group">
                <label *ngIf="(issue.tags.length > 0)"
                       for="currenttag">Current tags</label>
                <ul class="list-group">
                    <li class="list-group-item"
                        *ngFor="let tag of issue.tags; let i = index;">
                        <span class="p-0 m-0">{{tag}}</span>
                        <span class="pull-right">
                            <button class="btn btn-xs btn-warning"
                                    (click)="removeTag(i)">Delete
                            </button>
                        </span>
                    </li>
                </ul>
            </div>

            <label for="picture">Picture URL</label>
            <div class="form-group form-inline">
                <input class="form-control col-8"
                       type="text"
                       name="picture"
                       id="picture"
                       #descriptionField="ngModel"
                       [(ngModel)]="newFirstPictureURL"
                       maxlength="500"
                       ng-pattern />
                <button class="form-control col-2 btn btn-primary float-right"
                        type="button"
                        (click)="addFirstPictureToIssue()">Add this picture</button>
            </div>

            <label for="additionalpictures">Additionnal pictures URL</label>
            <div class="form-group form-inline">
                <input class="form-control col-8"
                       type="text"
                       name="additionalpictures"
                       id="additionalpictures"
                       #descriptionField="ngModel"
                       [(ngModel)]="newAdditionalPictureURL"
                       maxlength="500"
                       ng-pattern />
                <button class="form-control col-2 btn btn-primary"
                        type="button"
                        (click)="addAdditionalPictureToIssue()">Add this picture</button>
            </div>

            <div class="form-group">
                <label *ngIf="(issue.additionalImageUrls.length > 0)"
                       for="currenttag">Current pictures</label>
                <ul class="list-group">
                    <li class="list-group-item"
                        *ngFor="let picture of issue.additionalImageUrls; let pic = index;">
                        <span class="p-0 m-0">{{picture}}</span>
                        <span class="pull-right">
                            <button class="btn btn-xs btn-warning"
                                    (click)="removePicture(pic)">Delete
                            </button>
                        </span>
                    </li>
                </ul>
            </div>

            <p> Current issue: {{issue | json}}</p>

            <!-- Bottom with buttons -->
            <div class="form-group">
                <div class="row rowDiv">
                    <button class="form-control btn btn-primary col-4"
                            type="submit"
                            [disabled]="IssueForm.invalid">
                        <ng-container *ngIf="isNewIssue">Create</ng-container>
                        <ng-container *ngIf="!isNewIssue">Update</ng-container>
                    </button>

                    <p *ngIf="issueError">
                        Unable to create the new issue. See the log for more information.
                    </p>
                    <button class="form-control btn btn-primary col-4 offset-4"
                            type="button"
                            (click)="goToAllIssues()">Cancel</button>
                </div>
            </div>

        </form>
    </div>
</div>